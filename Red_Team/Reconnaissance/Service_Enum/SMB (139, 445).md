Samba
[[Reconnaissance/Tools/Impacket|Impacket]]
[[CrackMapExec]]
[[Responder]]

NAP3UNCC@htb[/htb]`$ crackmapexec smb 10.10.110.17 -u /tmp/userlist.txt -p 'Company01!' --lo`
## CMDs

```shell-session
sudo nmap 10.129.14.128 -sV -sC -p139,445
```
### ENUM
```shell-session
sudo nmap 10.129.14.128 -sV -sC -p139,445

smbclient -N -L //10.129.14.128

smbmap -H 10.129.14.128 
// use -r or -R(recursive) to browse found dir
smbmap -H 10.129.14.128 -r `<share>`
smbmap -H 10.129.14.128 --download "notes\note.txt"
smbmap -H 10.129.14.128 --upload test.txt "notes\test.txt"


```

## Windows Specific 

Go to service 
`[WINKEY]` + R   `\\<IP>\<share>
```cmd-session
dir \\192.168.220.129\Finance\
```
```cmd-session
net use n: \\192.168.220.129\Finance /user:plaintext Password123
```
Find out how many files in share 
```cmd-session
dir n: /a-d /s /b | find /c ":\"
```
|**Syntax**|**Description**|
|---|---|
|`dir`|Application|
|`n:`|Directory or drive to search|
|`/a-d`|`/a` is the attribute and `-d` means not directories|
|`/s`|Displays files in a specified directory and all subdirectories|
|`/b`|Uses bare format (no heading information or summary)|

With `dir` we can search for specific names in files such as:

- cred
- password
- users
- secrets
- key
- Common File Extensions for source code such as: .cs, .c, .go, .java, .php, .asp, .aspx, .html.
```cmd-session
C:\htb>dir n:\*cred* /s /b

n:\Contracts\private\credentials.txt


C:\htb>dir n:\*secret* /s /b

n:\Contracts\private\secret.txt
```
If we want to search for a specific word within a text file, we can use [findstr](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/findstr).

#### Windows CMD - Findstr

```cmd-session
c:\htb>findstr /s /i cred n:\*.*
```

## Linux
`sudo apt install cifs-utils`
#### Linux - Mount

NAP3UNCC@htb[/htb]`$ sudo mkdir /mnt/Finance $ sudo mount -t cifs -o username=plaintext,password=Password123,domain=. //192.168.220.129`
```shell-session
find /mnt/Finance/ -name *cred*
```



## Enum4Linux
automate enum
```shell-session
./enum4linux-ng.py 10.10.11.45 -A -C
```
[Download][https://github.com/CiscoCXSecurity/enum4linux]

### RPC Client
We can use the `rpcclient` tool with a null session to enumerate a workstation or Domain Controller.
```shell-session
rpcclient -U'%' 10.10.110.17
rpcclient $> enumdomusers
```
[full List of cmds][https://www.samba.org/samba/docs/current/man-html/rpcclient.1.html]
[Cheat Sheet][https://www.willhackforsushi.com/sec504/SMB-Access-from-Linux.pdf]


## Dangerous Settings 
Check for anonymous authentication 
NULL SESSION
[SMBGhost][https://arista.my.site.com/AristaCommunity/s/article/SMBGhost-Wormable-Vulnerability-Analysis-CVE-2020-0796] - [POC][https://www.exploit-db.com/exploits/48537]

## Spidering

## Tools



smbclient
crackMapExec
SMBMap
psexec.py
smbexec.py



#smb
